{
  "variables": {
    "bot_token": "{{env `BOT_TOKEN`}}",
    "bot_chat_id": "{{env `BOT_CHAT_ID`}}",
    "chat_id": "{{env `CHAT_ID`}}",
    "youtube_key": "{{env `YOUTUBE_KEY`}}",
    "app_name": "youtube-audio",
    "youtube_dl_name": "server/youtube-dl",
    "configure_file_name": "server/configure.sh",
    "start_file_name": "server/start.sh",
    "app_source_file": "../youtube-audio",
    "youtube_dl_dest_file": "/usr/local/sbin/youtube-dl",
    "configure_file": "/configure.sh",
    "start_file": "/start.sh",
    "deployment_dir": "/",
    "tmp_dir": "/tmp"
  },
  "builders": [{
    "type":"docker",
    "image":"centos:centos7.9.2009",
    "commit": true,
    "changes": [
      "ENV BOT_TOKEN {{ user `bot_token` }}",
      "ENV BOT_CHAT_ID {{ user `bot_chat_id` }}",
      "ENV CHAT_ID {{ user `chat_id` }}",
      "ENV YOUTUBE_KEY {{ user `youtube_key` }}"
    ]
  }],
  "provisioners": [
    {
      "type": "file",
      "source": "{{user `app_source_file`}}",
      "destination": "{{user `deployment_dir`}}{{user `app_name`}}"
    },
    {
      "type": "file",
      "source": "{{user `youtube_dl_name`}}",
      "destination": "{{user `youtube_dl_dest_file`}}"
    },
    {
      "type": "file",
      "source": "{{user `configure_file_name`}}",
      "destination": "{{user `configure_file`}}"
    },
    {
      "type": "file",
      "source": "{{user `start_file_name`}}",
      "destination": "{{user `start_file`}}"
    },
    {
      "type": "shell",
      "scripts": [
        "{{user `configure_file_name`}}",
        "{{user `start_file_name`}}"
      ],
      "environment_vars": [
        "FOO={{ user `tmp_dir` }}"
      ]
    }
  ],
  "post-processors": [
    [
      {
        "type": "docker-tag",
        "repository": "youtube-audio",
        "tag": "v0.1.0"
      }
    ]
  ]
}